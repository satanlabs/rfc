<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head profile="http://dublincore.org/documents/2008/08/04/dc-html/">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="robots" content="index,follow" />
    <meta name="creator" content="rfcmarkup version 1.129b" />
    <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" />
      <meta name="DC.Identifier" content="urn:ietf:rfc:2033" />
      <meta name="DC.Relation.Replaces" content=""/><meta name="DC.Creator" content="J. Myers"><meta name="DC.Date.Issued" content="October, 1996"/>
       <meta name="DC.Title" content=" Local Mail Transfer Protocol "/>
       <title>RFC 2033:  Local Mail Transfer Protocol </title>    
        

        <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->    <script type="text/javascript"><!--
    function addHeaderTags() {
        var spans = document.getElementsByTagName("span");
        for (var i=0; i < spans.length; i++) {
            var elem = spans[i];
            if (elem) {
                var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";               
                }
            }
        }
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script><span class="pre noprint docinfo">[<a href="https://www.rfc-editor.org" title="RFC Editor">RFC Home</a>] [<a href=/rfc/rfc2033.txt>TEXT</a>|<a href=/rfc/pdfrfc/rfc2033.txt.pdf>PDF</a>|<a href=/rfc/rfc2033.html>HTML</a>] [<a href='https://datatracker.ietf.org/doc/rfc2033' title='IETF Datatracker information for this document'>Tracker</a>] [<a href="https://datatracker.ietf.org/ipr/search/?rfc=2033&submit=rfc" title="IPR disclosures related to this document">IPR</a>]                              </span><br/><span class="pre noprint docinfo">                                                                        </span><br /><span class="pre noprint docinfo">                                                           INFORMATIONAL</span><br /><span class="pre noprint docinfo">                                                                        </span><pre>Network Working Group                                           J. Myers
Request for Comments: 2033                               Carnegie Mellon
Category: Informational                                     October 1996


                      <span class="h1">Local Mail Transfer Protocol</span>

Status of this Memo

   This memo provides information for the Internet community.  This memo
   does not specify an Internet standard of any kind.  Distribution of
   this memo is unlimited.

<span class="h2"><a class="selflink" id="section-1" href="#section-1">1</a>.  Abstract</span>

   SMTP [<a href="#ref-SMTP" title="&quot;Simple Mail Transfer Protocol&quot;">SMTP</a>] [<a href="#ref-HOST-REQ" title="&quot;Requirements for Internet hosts - application and support&quot;">HOST-REQ</a>] and its service extensions [<a href="#ref-ESMTP" title="&quot;SMTP Service Extensions&quot;">ESMTP</a>] provide a
   mechanism for transferring mail reliably and efficiently.  The design
   of the SMTP protocol effectively requires the server to manage a mail
   delivery queue.

   In some limited circumstances, outside the area of mail exchange
   between independent hosts on public networks, it is desirable to
   implement a system where a mail receiver does not manage a queue.
   This document describes the LMTP protocol for transporting mail into
   such systems.

   Although LMTP is an alternative protocol to ESMTP, it uses (with a
   few changes) the syntax and semantics of ESMTP.  This design permits
   LMTP to utilize the extensions defined for ESMTP.  LMTP should be
   used only by specific prior arrangement and configuration, and it
   MUST NOT be used on TCP port 25.

Table of Contents

   <a href="#section-1">1</a>.   Abstract ................................................    <a href="#page-1">1</a>
   <a href="#section-2">2</a>.   Conventions Used in this Document .......................    <a href="#page-2">2</a>
   <a href="#section-3">3</a>.   Introduction and Overview ...............................    <a href="#page-2">2</a>
   <a href="#section-4">4</a>.   The LMTP protocol .......................................    <a href="#page-3">3</a>
   <a href="#section-4.1">4.1</a>. The LHLO, HELO and EHLO commands ........................    <a href="#page-4">4</a>
   <a href="#section-4.2">4.2</a>. The DATA command ........................................    <a href="#page-4">4</a>
   <a href="#section-4.3">4.3</a>. The BDAT command ........................................    <a href="#page-5">5</a>
   <a href="#section-5">5</a>.   Implementation requirements .............................    <a href="#page-6">6</a>
   <a href="#section-6">6</a>.   Acknowledgments .........................................    <a href="#page-6">6</a>
   <a href="#section-7">7</a>.   References ..............................................    <a href="#page-7">7</a>
   <a href="#section-8">8</a>.   Security Considerations .................................    <a href="#page-7">7</a>
   <a href="#section-9">9</a>.   Author's Address ........................................    <a href="#page-7">7</a>





<span class="grey">Myers                        Informational                      [Page 1]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-2" ></span>
<span class="grey"><a href="./rfc2033">RFC 2033</a>                          LMTP                      October 1996</span>


<span class="h2"><a class="selflink" id="section-2" href="#section-2">2</a>.  Conventions Used in this Document</span>

   In examples, "C:" and "S:" indicate lines sent by the client and
   server respectively.

<span class="h2"><a class="selflink" id="section-3" href="#section-3">3</a>.  Introduction and Overview</span>

   The design of the SMTP protocol effectively requires the server to
   manage a mail delivery queue.  This is because a single mail
   transaction may specify multiple recipients and the final "." of the
   DATA command may return only one reply code, to indicate the status
   of the entire transaction.  If, for example, a server is given a
   transaction for two recipients, delivery to the first succeeds, and
   delivery to the second encounters a temporary failure condition,
   there is no mechanism to inform the client of the situation.  The
   server must queue the message and later attempt to deliver it to the
   second recipient.

   This queuing requirement is beneficial in the situation for which
   SMTP was originally designed: store-and-forward relay of mail between
   networked hosts.  In some limited situations, it is desirable to have
   a server which does not manage a queue, instead relying on the client
   to perform queue management.  As an example, consider a hypothetical
   host with a mail system designed as follows:



                    TCP port 25 +-----------------+
         ----------------------&gt;|                 |  #########
                                |      Queue      |&lt;&gt;# Mail  #
         TCP port 25            |     Manager     |  # Queue #
         &lt;----------------------|                 |  #########
                                +-----------------+
                            Local *  ^ Local    * Local
                              IPC *  | IPC      * IPC
                                  *  |          *
                                  *  |          *
                                  *  |          *
                                  V  |          V
                  Non-SMTP    +----------+     +----------+
                  Protocol    | Gateway  |     |  Local   |  #########
              &lt;==============&gt;| Delivery |     | Delivery |&gt;&gt;# Mail  #
                              |  Agent   |     |  Agent   |  # Spool #
                              +----------+     +----------+  #########


   The host's mail system has three independent, communicating
   subsystems.  The first is a queue manager, which acts as a



<span class="grey">Myers                        Informational                      [Page 2]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-3" ></span>
<span class="grey"><a href="./rfc2033">RFC 2033</a>                          LMTP                      October 1996</span>


   traditional SMTP agent, transferring messages to and from other hosts
   over TCP and managing a mail queue in persistent storage.  The other
   two are agents which handle delivery for addresses in domains for
   which the host takes responsibility.  One agent performs gatewaying
   to and from some other mail system.  The other agent delivers the
   message into a persistent mail spool.

   It would be desirable to use SMTP over a local inter-process
   communication channel to transfer messages from the queue manager to
   the delivery agents.  It would, however, significantly increase the
   complexity of the delivery agents to require them to manage their own
   mail queues.

   The common practice of invoking a delivery agent with the envelope
   address(es) as command-line arguments, then having the delivery agent
   communicate status with an exit code has three serious problems: the
   agent can only return one exit code to be applied to all recipients,
   it is difficult to extend the interface to deal with ESMTP extensions
   such as DSN [<a href="#ref-DSN" title="&quot;An Extensible Message Format for Delivery Status Notifications&quot;">DSN</a>] and ENHANCEDSTATUSCODES [<a href="#ref-ENHANCEDSTATUSCODES" title="&quot;SMTP Service Extension for Returning Enhanced Error Codes&quot;">ENHANCEDSTATUSCODES</a>], and
   exits performed by system libraries due to temporary conditions
   frequently get interpreted as permanent errors.

   The LMTP protocol causes the server to return, after the final "." of
   the DATA command, one reply for each recipient.  Therefore, if the
   queue manager is configured to use LMTP instead of SMTP when
   transferring messages to the delivery agents, then the delivery
   agents may attempt delivery to each recipient after the final "." and
   individually report the status for each recipient.  Connections which
   should use the LMTP protocol are drawn in the diagram above using
   asterisks.

   Note that it is not beneficial to use the LMTP protocol when
   transferring messages to the queue manager, either from the network
   or from a delivery agent.  The queue manager does implement a mail
   queue, so it may store the message and take responsibility for later
   delivering it.

<span class="h2"><a class="selflink" id="section-4" href="#section-4">4</a>.  The LMTP protocol</span>

   The LMTP protocol is identical to the SMTP protocol SMTP [<a href="#ref-SMTP" title="&quot;Simple Mail Transfer Protocol&quot;">SMTP</a>]
   [<a href="#ref-HOST-REQ" title="&quot;Requirements for Internet hosts - application and support&quot;">HOST-REQ</a>] with its service extensions [<a href="#ref-ESMTP" title="&quot;SMTP Service Extensions&quot;">ESMTP</a>], except as modified by
   this document.

   A "successful" RCPT command is defined as an RCPT command which
   returns a Positive Completion reply code.

   A "Positive Completion reply code" is defined in <a href="#appendix-E">Appendix E</a> of STD
   10, <a href="./rfc821">RFC 821</a> [<a href="#ref-SMTP" title="&quot;Simple Mail Transfer Protocol&quot;">SMTP</a>] as a reply code which "2" as the first digit.



<span class="grey">Myers                        Informational                      [Page 3]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-4" ></span>
<span class="grey"><a href="./rfc2033">RFC 2033</a>                          LMTP                      October 1996</span>


<span class="h3"><a class="selflink" id="section-4.1" href="#section-4.1">4.1</a>.  The LHLO, HELO and EHLO commands</span>

   The HELO and EHLO commands of ESMTP are replaced by the LHLO command.
   This permits a misconfiguration where both parties are not using the
   same protocol to be detected.

   The LHLO command has identical semantics to the EHLO command of ESMTP
   [<a href="#ref-ESMTP" title="&quot;SMTP Service Extensions&quot;">ESMTP</a>].

   The HELO and EHLO commands of ESMTP are not present in LMTP.  A LMTP
   server MUST NOT return a Postive Completion reply code to these
   commands.  The 500 reply code is recommended.

<span class="h3"><a class="selflink" id="section-4.2" href="#section-4.2">4.2</a>.  The DATA command</span>

   In the LMTP protocol, there is one additional restriction placed on
   the DATA command, and one change to how replies to the final "." are
   sent.

   The additional restriction is that when there have been no successful
   RCPT commands in the mail transaction, the DATA command MUST fail
   with a 503 reply code.

   The change is that after the final ".", the server returns one reply
   for each previously successful RCPT command in the mail transaction,
   in the order that the RCPT commands were issued.  Even if there were
   multiple successful RCPT commands giving the same forward-path, there
   must be one reply for each successful RCPT command.

   When one of these replies to the final "." is a Positive Completion
   reply, the server is accepting responsibility for delivering or
   relying the message to the corresponding recipient.  It must take
   this responsibility seriously, i.e., it MUST NOT lose the message for
   frivolous reasons, e.g., because the host later crashes or because of
   a predictable resource shortage.

   A multiline reply is still considered a single reply and corresponds
   to a single RCPT command.

   EXAMPLE:

   S: 220 foo.edu LMTP server ready
   C: LHLO foo.edu
   S: 250-foo.edu
   S: 250-PIPELINING
   S: 250 SIZE
   C: MAIL FROM:&lt;chris@bar.com&gt;
   S: 250 OK



<span class="grey">Myers                        Informational                      [Page 4]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-5" ></span>
<span class="grey"><a href="./rfc2033">RFC 2033</a>                          LMTP                      October 1996</span>


   C: RCPT TO:&lt;pat@foo.edu&gt;
   S: 250 OK
   C: RCPT TO:&lt;jones@foo.edu&gt;
   S: 550 No such user here
   C: RCPT TO:&lt;green@foo.edu&gt;
   S: 250 OK
   C: DATA
   S: 354 Start mail input; end with &lt;CRLF&gt;.&lt;CRLF&gt;
   C: Blah blah blah...
   C: ...etc. etc. etc.
   C: .
   S: 250 OK
   S: 452 &lt;green@foo.edu&gt; is temporarily over quota
   C: QUIT
   S: 221 foo.edu closing connection


NOTE: in the above example, the domain names of both the client and
   server are identical.  This is because in the example the client and
   server are different subsystems of the same mail domain.

<span class="h3"><a class="selflink" id="section-4.3" href="#section-4.3">4.3</a>.  The BDAT command</span>

   If the server supports the ESMTP CHUNKING extension [<a href="#ref-BINARYMIME" title="&quot;SMTP Service Extensions for Transmission of Large and Binary MIME Messages&quot;">BINARYMIME</a>], a
   BDAT command containing the LAST parameter returns one reply for each
   previously successful RCPT command in the mail transaction, in the
   order that the RCPT commands were issued.  Even if there were
   multiple successful RCPT commands giving the same forward-path, there
   must be one reply for each successful RCPT command.  If there were no
   previously successful RCPT commands in the mail transaction, then the
   BDAT LAST command returns zero replies.

   When one of these replies to the BDAT LAST command is a Positive
   Completion reply, the server is accepting responsibility for
   delivering or relaying the message to the corresponding recipient.
   It must take this responsibility seriously, i.e., it MUST NOT lose
   the message for frivolous reasons, e.g., because the host later
   crashes or because of a predictable resource shortage.

   A multiline reply is still considered a single reply and corresponds
   to a single RCPT command.

   The behavior of BDAT commands without the LAST parameter is not
   changed; they still return exactly one reply.







<span class="grey">Myers                        Informational                      [Page 5]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-6" ></span>
<span class="grey"><a href="./rfc2033">RFC 2033</a>                          LMTP                      October 1996</span>


<span class="h2"><a class="selflink" id="section-5" href="#section-5">5</a>.  Implementation requirements</span>

   As LMTP is a different protocol than SMTP, it MUST NOT be used on the
   TCP service port 25.

   A server implementation MUST implement the PIPELINING [<a href="#ref-PIPELINING" title="&quot;SMTP Service Extension for Command Pipelining&quot;">PIPELINING</a>]
   and ENHANCEDSTATUSCODES [<a href="#ref-ENHANCEDSTATUSCODES" title="&quot;SMTP Service Extension for Returning Enhanced Error Codes&quot;">ENHANCEDSTATUSCODES</a>] ESMTP extensions.  A
   server implementation SHOULD implement the 8BITMIME [<a href="#ref-8BITMIME" title="&quot;SMTP Service Extension for 8bit-MIME transport&quot;">8BITMIME</a>]
   extension.

   Use of LMTP can aggravate the situation described in [<a href="#ref-DUP-MSGS" title="&quot;Duplicate messages and SMTP&quot;">DUP-MSGS</a>].  To
   avoid this synchronization problem, the following requirements are
   made of implementations:

   A server implementation which is capable of quickly accepting
   responsibility for delivering or relaying a message to multiple
   recipients and which is capable of sending any necessary notification
   messages SHOULD NOT implement the LMTP protocol.

   The LMTP protocol SHOULD NOT be used over wide area networks.

   The server SHOULD send each reply as soon as possible.  If it is
   going to spend a nontrivial amount of time handling delivery for the
   next recipient, it SHOULD flush any outgoing LMTP buffer, so the
   reply may be quickly received by the client.

   The client SHOULD process the replies as they come in, instead of
   waiting for all of the replies to arrive before processing any of
   them.  If the connection closes after replies for some, but not all,
   recipients have arrived, the client MUST process the replies that
   arrived and treat the rest as temporary failures.

<span class="h2"><a class="selflink" id="section-6" href="#section-6">6</a>.  Acknowledgments</span>

   This work is a refinement of the MULT extension, which was invented
   by Jeff Michaud and was used in implementing gateways to the Mail-11
   mail system.

   Many thanks to Matt Thomas for assisting me in understanding the
   semantics of the Mail-11 MULT extension.











<span class="grey">Myers                        Informational                      [Page 6]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-7" ></span>
<span class="grey"><a href="./rfc2033">RFC 2033</a>                          LMTP                      October 1996</span>


<span class="h2"><a class="selflink" id="section-7" href="#section-7">7</a>.  References</span>

   [<a id="ref-8BITMIME">8BITMIME</a>] Klensin, J., et. al, "SMTP Service Extension for 8bit-MIME
       transport", <a href="./rfc1652">RFC 1652</a>, July 1994.

   [<a id="ref-BINARYMIME">BINARYMIME</a>] Vaudreuil, G., "SMTP Service Extensions for Transmission
       of Large and Binary MIME Messages", <a href="./rfc1830">RFC 1830</a>, August 1995.

   [<a id="ref-DSN">DSN</a>] Moore, K., Vaudreuil, G., "An Extensible Message Format for
       Delivery Status Notifications", <a href="./rfc1894">RFC 1894</a>, January 1996.

   [<a id="ref-DUP-MSGS">DUP-MSGS</a>] Partridge, C., "Duplicate messages and SMTP", <a href="./rfc1047">RFC 1047</a>,
       February 1988.

   [<a id="ref-ENHANCEDSTATUSCODES">ENHANCEDSTATUSCODES</a>] Freed, N., "SMTP Service Extension for
       Returning Enhanced Error Codes", <a href="./rfc2034">RFC 2034</a>, October 1996.

   [<a id="ref-ESMTP">ESMTP</a>] Rose, M., Stefferud, E., Crocker, C., Klensin, J., Freed, N.,
       "SMTP Service Extensions", <a href="./rfc1869">RFC 1869</a>, November 1995.

   [<a id="ref-HOST-REQ">HOST-REQ</a>] Braden, R., "Requirements for Internet hosts - application
       and support", STD 3, <a href="./rfc1123#section-5">RFC 1123 section&nbsp;5</a>, October 1989.

   [<a id="ref-PIPELINING">PIPELINING</a>] Freed, N., Cargille, A, "SMTP Service Extension for
       Command Pipelining", <a href="./rfc1854">RFC 1854</a>, October 1995.

   [<a id="ref-SMTP">SMTP</a>] Postel, J., "Simple Mail Transfer Protocol", STD 10, <a href="./rfc821">RFC 821</a>,
       August 1982.


   There are no known security issues with the issues in this memo.

<span class="h2"><a class="selflink" id="section-9" href="#section-9">9</a>.  Author's Address</span>

   John G. Myers
   Carnegie-Mellon University
   5000 Forbes Ave.
   Pittsburgh PA, 15213-3890

   EMail: jgm+@cmu.edu











Myers                        Informational                      [Page 7]
</pre>
