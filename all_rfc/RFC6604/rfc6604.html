<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head profile="http://dublincore.org/documents/2008/08/04/dc-html/">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="robots" content="index,follow" />
    <meta name="creator" content="rfcmarkup version 1.129b" />
    <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" />
      <meta name="DC.Identifier" content="urn:ietf:rfc:6604" />
      <meta name="DC.Relation.Replaces" content=""/><meta name="DC.Creator" content="D. Eastlake 3rd"><meta name="DC.Date.Issued" content="April, 2012"/>
       <meta name="DC.Title" content="xNAME RCODE and Status Bits Clarification"/>
       <title>RFC 6604: xNAME RCODE and Status Bits Clarification</title>    
        

        <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->    <script type="text/javascript"><!--
    function addHeaderTags() {
        var spans = document.getElementsByTagName("span");
        for (var i=0; i < spans.length; i++) {
            var elem = spans[i];
            if (elem) {
                var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";               
                }
            }
        }
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script><span class="pre noprint docinfo">[<a href="https://www.rfc-editor.org" title="RFC Editor">RFC Home</a>] [<a href=/rfc/rfc6604.txt>TEXT</a>|<a href=/rfc/pdfrfc/rfc6604.txt.pdf>PDF</a>|<a href=/rfc/rfc6604.html>HTML</a>] [<a href='https://datatracker.ietf.org/doc/rfc6604' title='IETF Datatracker information for this document'>Tracker</a>] [<a href="https://datatracker.ietf.org/ipr/search/?rfc=6604&submit=rfc" title="IPR disclosures related to this document">IPR</a>]                              </span><br/><span class="pre noprint docinfo">                                                                        </span><br /><span class="pre noprint docinfo">                                                       PROPOSED STANDARD</span><br /><span class="pre noprint docinfo">                                                                        </span><pre>Internet Engineering Task Force (IETF)                   D. Eastlake 3rd
Request for Comments: 6604                                        Huawei
Updates: <a href="./rfc1035">1035</a>, <a href="./rfc2308">2308</a>, <a href="./rfc2672">2672</a>                                     April 2012
Category: Standards Track
ISSN: 2070-1721


               <span class="h1">xNAME RCODE and Status Bits Clarification</span>

Abstract

   The Domain Name System (DNS) has long provided means, such as the
   CNAME (Canonical Name), whereby a DNS query can be redirected to a
   different name.  A DNS response header has an RCODE (Response Code)
   field, used for indicating errors, and response status bits.  This
   document clarifies, in the case of such redirected queries, how the
   RCODE and status bits correspond to the initial query cycle (where
   the CNAME or the like was detected) and subsequent or final query
   cycles.

Status of This Memo

   This is an Internet Standards Track document.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Further information on
   Internet Standards is available in <a href="./rfc5741#section-2">Section&nbsp;2 of RFC 5741</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc6604">http://www.rfc-editor.org/info/rfc6604</a>.

Copyright Notice

   Copyright (c) 2012 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://www.rfc-editor.org/bcp/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.



<span class="grey">Eastlake                     Standards Track                    [Page 1]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-2" ></span>
<span class="grey"><a href="./rfc6604">RFC 6604</a>                xNAME RCODE Clarification             April 2012</span>


Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-2">2</a>
      <a href="#section-1.1">1.1</a>. Conventions Used in This Document ..........................<a href="#page-3">3</a>
   <a href="#section-2">2</a>. Restatement of Status Bits and What They Mean ...................<a href="#page-3">3</a>
      <a href="#section-2.1">2.1</a>. The Authoritative Answer Bit ...............................<a href="#page-3">3</a>
      <a href="#section-2.2">2.2</a>. The Authentic Data Bit .....................................<a href="#page-3">3</a>
   <a href="#section-3">3</a>. RCODE Clarification .............................................<a href="#page-3">3</a>
   <a href="#section-4">4</a>. Security Considerations .........................................<a href="#page-4">4</a>
   <a href="#section-5">5</a>. References ......................................................<a href="#page-4">4</a>
      <a href="#section-5.1">5.1</a>. Normative References .......................................<a href="#page-4">4</a>
      <a href="#section-5.2">5.2</a>. Informative References .....................................<a href="#page-5">5</a>

<span class="h2"><a class="selflink" id="section-1" href="#section-1">1</a>.  Introduction</span>

   The Domain Name System (DNS) has long provided means, such as the
   CNAME (Canonical Name [<a href="./rfc1035" title="&quot;Domain names - implementation and specification&quot;">RFC1035</a>]) and DNAME [<a href="./rfc2672" title="&quot;Non-Terminal DNS Name Redirection&quot;">RFC2672</a>] RRs (Resource
   Records), whereby a DNS query can be redirected to a different name.
   In particular, CNAME normally causes a query to its owner name to be
   redirected, while DNAME normally causes a query to any lower-level
   name to be redirected.  There has been a proposal for another
   redirection RR.  In addition, as specified in [<a href="./rfc2672" title="&quot;Non-Terminal DNS Name Redirection&quot;">RFC2672</a>], redirection
   through a DNAME also results in the synthesis of a CNAME RR in the
   response.  In this document, we will refer to all RRs causing such
   redirection as xNAME RRs.

   xNAME RRs can be explicitly retrieved by querying for the xNAME type.
   When a different type is queried and an xNAME RR is encountered, the
   xNAME RR (and possibly a synthesized CNAME) is added to the answer in
   the response, DNS Security Extensions (DNSSEC) [<a href="./rfc4035" title="&quot;Protocol Modifications for the DNS Security Extensions&quot;">RFC4035</a>] RRs
   applicable to the xNAME RR may be added to the response, and the
   query is restarted with the name to which it was redirected.

   An xNAME may redirect a query to a name at which there is another
   xNAME and so on.  In this document, we use "xNAME chain" to refer to
   a series of one or more xNAMEs each of which refers to another xNAME
   except the last, which refers to a non-xNAME or results in an error.

   A DNS response header has an RCODE (Response Code) field, used for
   indicating errors, and status bits that indicate whether an answer is
   authoritative and/or authentic.  This document clarifies, in the case
   of such redirected queries, how the RCODE and status bits correspond
   to the initial query cycle (where the (first) xNAME was detected) and
   subsequent or final query cycles.







<span class="grey">Eastlake                     Standards Track                    [Page 2]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-3" ></span>
<span class="grey"><a href="./rfc6604">RFC 6604</a>                xNAME RCODE Clarification             April 2012</span>


<span class="h3"><a class="selflink" id="section-1.1" href="#section-1.1">1.1</a>.  Conventions Used in This Document</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [<a href="./rfc2119" title="&quot;Key words for use in RFCs to Indicate Requirement Levels&quot;">RFC2119</a>].

<span class="h2"><a class="selflink" id="section-2" href="#section-2">2</a>.  Restatement of Status Bits and What They Mean</span>

   There are two status bits returned in query responses for which a
   question could arise as to how, in the case of an xNAME chain, they
   relate to the first, possible intermediate, and/or last queries, as
   below.  Note that the following is unchanged from [<a href="./rfc1035" title="&quot;Domain names - implementation and specification&quot;">RFC1035</a>] and
   [<a href="./rfc4035" title="&quot;Protocol Modifications for the DNS Security Extensions&quot;">RFC4035</a>].  The meaning of these bits is simply restated here for
   clarity, because of observations of released implementations that did
   not follow these meanings.

<span class="h3"><a class="selflink" id="section-2.1" href="#section-2.1">2.1</a>.  The Authoritative Answer Bit</span>

   The AA, or Authoritative Answer bit, in the DNS response header
   indicates that the answer returned is from a DNS server authoritative
   for the zone containing that answer.  For an xNAME chain, this
   "authoritative" status could be different for each answer in that
   chain.

   [<a id="ref-RFC1035">RFC1035</a>] states that the AA bit is to be set based on whether the
   server providing the answer with the first owner name in the answer
   section is authoritative.  This specification of the AA bit has not
   been changed.

<span class="h3"><a class="selflink" id="section-2.2" href="#section-2.2">2.2</a>.  The Authentic Data Bit</span>

   The AD, or Authentic Data bit, indicates that the response returned
   is authentic according to the dictates of DNSSEC [<a href="./rfc4035" title="&quot;Protocol Modifications for the DNS Security Extensions&quot;">RFC4035</a>].
   [<a href="./rfc4035" title="&quot;Protocol Modifications for the DNS Security Extensions&quot;">RFC4035</a>] unambiguously states that the AD bit is to be set in a DNS
   response header only if the DNSSEC-enabled server believes all RRs in
   the answer and authority sections of that response to be authentic.
   This specification of the AD bit has not been changed.

<span class="h2"><a class="selflink" id="section-3" href="#section-3">3</a>.  RCODE Clarification</span>

   The RCODE field in a DNS query response header is non-zero to
   indicate an error.  <a href="./rfc1034#section-4.3.2">Section&nbsp;4.3.2 of [RFC1034]</a> has a resolution
   algorithm that includes CNAME processing but has been found to be
   unclear concerning the ultimate setting of RCODE in the case of such
   redirection.  <a href="./rfc2308#section-2.1">Section&nbsp;2.1 of [RFC2308]</a> implies that the RCODE should
   be set based on the last query cycle in the case of an xNAME chain,
   but <a href="./rfc2308#section-2.2.1">Section&nbsp;2.2.1 of [RFC2308]</a> says that some servers don't do that!




<span class="grey">Eastlake                     Standards Track                    [Page 3]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-4" ></span>
<span class="grey"><a href="./rfc6604">RFC 6604</a>                xNAME RCODE Clarification             April 2012</span>


   When there is an xNAME chain, the RCODE field is set as follows:

      When an xNAME chain is followed, all but the last query cycle
      necessarily had no error.  The RCODE in the ultimate DNS response
      MUST BE set based on the final query cycle leading to that
      response.  If the xNAME chain was terminated by an error, it will
      be that error code.  If the xNAME chain terminated without error,
      it will be zero.

<span class="h2"><a class="selflink" id="section-4" href="#section-4">4</a>.  Security Considerations</span>

   The AA header flag bit is not protected by DNSSEC [<a href="./rfc4033" title="&quot;DNS Security Introduction and Requirements&quot;">RFC4033</a>].  To
   secure it, secure communications are needed between the querying
   resolver and the DNS server.  Such security can be provided by DNS
   transaction security, either TSIG [<a href="./rfc2845" title="&quot;Secret Key Transaction Authentication for DNS (TSIG)&quot;">RFC2845</a>] or SIG(0) [<a href="./rfc2931" title="&quot;DNS Request and Transaction Signatures ( SIG(0)s )&quot;">RFC2931</a>].

   An AD header flag bit and the RCODE in a response are not, in
   general, protected by DNSSEC, so the same conditions as stated in the
   previous paragraph generally apply to them; however, this is not
   always true.  In particular, if the following apply, then the AD bit
   and an NXDOMAIN RCODE are protected by DNSSEC in the sense that the
   querier can calculate whether they are correct:

   1. The zone where an NXDOMAIN RCODE occurs or all the zones where the
      data whose authenticity would be indicated by the AD flag bit are
      signed zones.

   2. The query or queries involved indicate that DNSSEC RRs are OK in
      responses.

   3. The responses providing these indications are from servers that
      include the additional DNSSEC RRs required by DNSSEC.

   4. The querier has appropriate trust anchor(s) and appropriately
      validates and processes the DNSSEC RRs in the response.

<span class="h2"><a class="selflink" id="section-5" href="#section-5">5</a>.  References</span>

<span class="h3"><a class="selflink" id="section-5.1" href="#section-5.1">5.1</a>.  Normative References</span>

   [<a id="ref-RFC1034">RFC1034</a>]   Mockapetris, P., "Domain names - concepts and
               facilities", STD 13, <a href="./rfc1034">RFC 1034</a>, November 1987.

   [<a id="ref-RFC1035">RFC1035</a>]   Mockapetris, P., "Domain names - implementation and
               specification", STD 13, <a href="./rfc1035">RFC 1035</a>, November 1987.

   [<a id="ref-RFC2119">RFC2119</a>]   Bradner, S., "Key words for use in RFCs to Indicate
               Requirement Levels", <a href="https://www.rfc-editor.org/bcp/bcp14">BCP 14</a>, <a href="./rfc2119">RFC 2119</a>, March 1997.



<span class="grey">Eastlake                     Standards Track                    [Page 4]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-5" ></span>
<span class="grey"><a href="./rfc6604">RFC 6604</a>                xNAME RCODE Clarification             April 2012</span>


   [<a id="ref-RFC2672">RFC2672</a>]   Crawford, M., "Non-Terminal DNS Name Redirection",
               <a href="./rfc2672">RFC 2672</a>, August 1999.

   [<a id="ref-RFC4035">RFC4035</a>]   Arends, R., Austein, R., Larson, M., Massey, D., and S.
               Rose, "Protocol Modifications for the DNS Security
               Extensions", <a href="./rfc4035">RFC 4035</a>, March 2005.

<span class="h3"><a class="selflink" id="section-5.2" href="#section-5.2">5.2</a>.  Informative References</span>

   [<a id="ref-RFC2308">RFC2308</a>]   Andrews, M., "Negative Caching of DNS Queries (DNS
               NCACHE)", <a href="./rfc2308">RFC 2308</a>, March 1998.

   [<a id="ref-RFC2845">RFC2845</a>]   Vixie, P., Gudmundsson, O., Eastlake 3rd, D., and B.
               Wellington, "Secret Key Transaction Authentication for
               DNS (TSIG)", <a href="./rfc2845">RFC 2845</a>, May 2000.

   [<a id="ref-RFC2931">RFC2931</a>]   Eastlake 3rd, D., "DNS Request and Transaction Signatures
               ( SIG(0)s )", <a href="./rfc2931">RFC 2931</a>, September 2000.

   [<a id="ref-RFC4033">RFC4033</a>]   Arends, R., Austein, R., Larson, M., Massey, D., and S.
               Rose, "DNS Security Introduction and Requirements",
               <a href="./rfc4033">RFC 4033</a>, March 2005.

Author's Address

   Donald E. Eastlake 3rd
   Huawei R&amp;D USA
   155 Beaver Street
   Milford, MA  01757

   Phone: +1-508-333-2270
   EMail: d3e3e3@gmail.com



















Eastlake                     Standards Track                    [Page 5]
</pre>
